------------------------------------------------------------------- Task 2 -------------------------------------------------------------------


-- Request 1
-- Вивести назви та місткості палат, розташованих у 5-му корпусі, місткістю 5 і більше місць,
-- якщо в цьому корпусі є хоча б одна палата місткістю понад 15 місць.

-- SELECT w.name, w.places 
-- FROM wards AS w
-- JOIN departments AS des
-- ON w.department_id = des.id
-- WHERE des.building = 5 
  -- AND w.places >= 5
  -- AND EXISTS (SELECT 1 
    -- FROM wards AS w
	-- JOIN departments AS des
	-- ON w.department_id = des.id
	-- WHERE des.building = 5	
	-- AND w.places > 15);



-- Request 2
-- Вивести назви відділень, у яких проводилося хоча б одне обстеження за останній тиждень.

-- SELECT DISTINCT des.name 
-- FROM doctors_examinations AS d_e
-- JOIN wards AS w
-- ON d_e.ward_id = w.id
-- JOIN departments AS des
-- ON w.department_id = des.id
-- WHERE (NOW() - d_e.ex_date) < '7 days';



-- Request 3
-- Вивести назви захворювань, для яких не проводяться обстеження.

-- SELECT dis.name
-- FROM diseases AS dis
-- WHERE dis.id NOT IN (
   -- SELECT dis.id
   -- FROM doctors_examinations AS d_e
   -- JOIN diseases AS dis
    -- ON d_e.disease_id = dis.id
   -- GROUP BY dis.id);




-- Request 4
-- Вивести повні імена лікарів, які не проводять обстеження.

-- SELECT CONCAT(ds.name, ' ', ds.surname) AS full_name
-- FROM doctors AS ds
-- WHERE ds.id NOT IN (
   -- SELECT ds.id
   -- FROM doctors_examinations AS d_e
   -- JOIN doctors AS ds
    -- ON d_e.doctor_id = ds.id
   -- GROUP BY ds.id);





-- Request 5
-- Вивести назви відділень, у яких не проводяться обстеження.

-- SELECT des.name AS dep_name
-- FROM departments AS des
-- WHERE des.id NOT IN (
   -- SELECT des.id
   -- FROM doctors_examinations AS d_e
   -- JOIN wards AS ws
    -- ON d_e.ward_id = ws.id
   -- JOIN departments AS des
	-- ON ws.department_id = des.id
   -- GROUP BY des.id);



-- Request 6
-- Вивести прізвища лікарів, які є інтернами.

-- SELECT ds.name AS doctor_name
-- FROM doctors AS ds
-- WHERE ds.id IN (
   -- SELECT ins.doctor_id
   -- FROM interns AS ins
   -- JOIN doctors AS ds
    -- ON ins.doctor_id = ds.id);



-- Request 7
-- Вивести прізвища інтернів, ставки яких більші, ніж ставка хоча б одного з лікарів.

-- SELECT ds.surname AS intern_surname
-- FROM doctors as ds
-- WHERE ds.id IN (
   -- SELECT ins.doctor_id
   -- FROM interns AS ins
   -- JOIN doctors AS ds
    -- ON ins.doctor_id = ds.id)
 -- AND ds.salary > (
   -- SELECT MIN(salary)
   -- FROM doctors);
   
-- SELECT name, salary
-- FROM doctors;
   
   



-- Request 8
-- Вивести назви палат, чия місткість більша, ніж місткість
-- кожної палати, що знаходиться в 3-му корпусі.

-- SELECT ws.name, ws.places
-- FROM wards AS ws
-- WHERE ws.id NOT IN (
   -- SELECT ws.id
   -- FROM wards AS ws
   -- JOIN departments AS des
    -- ON ws.department_id = des.id
   -- WHERE des.building = 3)
 -- AND ws.places > (
   -- SELECT MAX(ws.places)
   -- FROM wards AS ws
   -- JOIN departments AS des
    -- ON ws.department_id = des.id
   -- WHERE des.building = 3
   -- );

-- SELECT ws.name, ws.places, des.name, des.building
-- FROM wards AS ws
-- JOIN departments AS des
 -- ON ws.department_id = des.id
-- ORDER BY ws.places desc;



-- Request 9
-- Вивести прізвища лікарів, які проводять обстеження у відділеннях “Ophthalmology” та “Physiotherapy”.

SELECT surname
FROM doctors
WHERE id IN (
   SELECT ds.id
   FROM doctors_examinations AS d_e
   JOIN doctors AS ds
    ON d_e.doctor_id = ds.id
   

-- Request 10
-- Вивести назви відділень, у яких працюють інтерни та професори.

SELECT * 
FROM departments AS des
WHERE des.id IN (
	 SELECT des.id 
     FROM doctors_examinations AS d_e
     JOIN wards AS w
       ON d_e.ward_id = w.id
     JOIN departments AS des
       ON w.department_id = des.id
     JOIN doctors AS dos
       ON d_e.doctor_id = dos.id
     JOIN interns AS ins
       ON ins.doctor_id = dos.id)
	AND des.id IN (
	 SELECT des.id 
     FROM doctors_examinations AS d_e
     JOIN wards AS w
       ON d_e.ward_id = w.id
     JOIN departments AS des
       ON w.department_id = des.id
     JOIN doctors AS dos
       ON d_e.doctor_id = dos.id
     JOIN professors AS ps
       ON ps.doctor_id = dos.id);




-- Request 11
-- Вивести повні імена лікарів та відділення у яких вони проводять обстеження,
-- якщо відділення має фонд фінансування понад 20000.





-- Request 12
-- Вивести назву відділення, в якому проводить обстеження лікар із найбільшою ставкою. Вивести
-- назви палат, чия місткість більша, ніж місткість кожної палати, що знаходиться в 3-му корпусі.




-- Request 13
-- Вивести назви захворювань та кількість проведених за ними обстежень.
